<html>
    <link href="dist/css/tabulator_modern.min.css" rel="stylesheet">
    <script type="text/javascript" src="dist/js/tabulator.min.js"></script>

    <body>
        <div>
            <h1>緊急タスク</h1>
            <div id="emergency"></div>
        </div>
        <div>
            <h1>残タスク</h1>
            <div id="todayTasks"></div>
        </div>
        <div>
            <h1>天気概況</h1>
            <table>
                <tr id="publishingOffice">
                    <th>発表者</th>
                    <td></td>
                </tr>
                <tr id="reportDatetime">
                    <th>報告日時</th>
                    <td></td>
                </tr>
                <!-- <tr id="targetArea">
                    <th>対象地域</th>
                    <td></td>
                </tr>
                <tr id="headlineText">
                    <th>ヘッドライン</th>
                    <td></td>
                </tr> -->
                <tr id="text">
                    <th>詳細</th>
                    <td></td>
                </tr>
            </table>

        </div>
    </body>
    <script>

var jsonRequest = function() {
    getTodayTasks();
    getEmergency();
    getWeather34();
}

window.addEventListener('load', function() {
    jsonRequest();
    time = setInterval(jsonRequest, 60 * 1000);
});

function getWeather34() {
    let url = "https://www.jma.go.jp/bosai/forecast/data/overview_forecast/340000.json";

    fetch(url)
        .then(function(response) {
            return response.json();
        })
        .then(function(weather) {
            console.log(weather);
            document.getElementById("publishingOffice").lastElementChild.textContent = weather.publishingOffice;
            document.getElementById("reportDatetime").lastElementChild.textContent = weather.reportDatetime;
            document.getElementById("text").lastElementChild.textContent = weather.text;
            // document.getElementById("targetArea").lastElementChild.textContent = weather.targetArea;
            // document.getElementById("headlineText").lastElementChild.textContent = weather.headlineText;
        });

}

function getEmergency() {
  var url = 'http://localhost:3000/tasks/emergency';
  fetch(url)
  .then(function (data) {
    return data.json();
  })
  .then(function (json) {
        //initialize table
        var table = new Tabulator("#emergency", {
            data: json,
            // autoColumns: true,
            columns:[
            {title:"TaskId", field:"id", formatter:"plaintext"},
            {title:"タスク名", field:"name", formatter:"plaintext", width:300},
            {title:"担当", field:"person", formatter:"plaintext", hozAlign:"center"},
            {title:"開始日", field:"jsDate", formatter:"plaintext", hozAlign:"center"},
            {title:"終了日", field:"jeDate", formatter:"plaintext", hozAlign:"center"},
            {title:"親タスク", field:"parent", formatter:"plaintext", hozAlign:"center"},
            {title:"進捗", field:"progress", formatter:"plaintext", hozAlign:"right"},
            // {title:"進捗", field:"progress", formatter:"progress", formatterParams:{color:["#00dd00", "orange", "rgb(255,0,0)"]}, sorter:"number", width:150  },
        ],
        });
 
        // table.setFilter("person", "=", "越智");
  });
}


function getTodayTasks() {
  var url = 'http://localhost:3000/tasks';
  fetch(url)
  .then(function (data) {
    return data.json();
  })
  .then(function (json) {
        //initialize table
        var table = new Tabulator("#todayTasks", {
            data: json,
            groupBy:"parent",
            // autoColumns: true,
            columns:[
            {title:"TaskId", field:"id", formatter:"plaintext"},
            {title:"タスク名", field:"name", formatter:"plaintext", width:300},
            {title:"担当", field:"person", formatter:"plaintext", hozAlign:"center"},
            {title:"開始日", field:"jsDate", formatter:"plaintext", hozAlign:"center"},
            {title:"終了日", field:"jeDate", formatter:"plaintext", hozAlign:"center"},
            {title:"親タスク", field:"parent", formatter:"plaintext", hozAlign:"center"},
            {title:"進捗", field:"progress", formatter:"plaintext", hozAlign:"right"},
            // {title:"進捗", field:"progress", formatter:"progress", formatterParams:{color:["#00dd00", "orange", "rgb(255,0,0)"]}, sorter:"number", width:100},
        ],
        });
 
        // table.setFilter("person", "!=", "");
  });
}

</script>
</html>